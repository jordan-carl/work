<!DOCTYPE html>
<html>
<head>
    <title>Elaw.my</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/jquery.mobile-1.3.0.min.css" />
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/jquery.mobile-1.3.0.min.js"></script>
    <script>
   
    </script>
    <style>
        #list{
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div id="main" data-role="page">
	<div data-role="panel" id="mypanel" data-display="overlay" data-dismissible="true">		  
            <div>
              <h3 align="center">Please sign in</h3>
              <label for="un" class="ui-hidden-accessible">Username:</label>
              <input name="user" id="un" value="" placeholder="username" type="text">
              <label for="pw" class="ui-hidden-accessible">Password:</label>
              <input name="pass" id="pw" value="" placeholder="password" type="password">
              <button id="login" data-icon="check">Sign in</button>
			  <p id="error" style="color:red;"></p>
            </div>
			<div>
				<h3 align="center">Or register ?</h3>
				<button id="register">Open browser</button>
			</div>
		<!-- panel content goes here -->
	</div><!-- /panel -->

    <div data-role="header" data-position="fixed" data-id="header1">
        <h1>Elaw.my</h1>
        <a href="" data-icon="home" data-theme="b">Home</a>
        <a href="options.html" data-icon="gear" class="ui-btn-right" data-theme="b">Options</a>


    </div><!-- /header -->

    <div data-role="content">
        <article>
    <ul data-role="listview" id="mylist" >
        <li>
            <!-- <img class="ui-li-thumb" src="icons/Documents-icon_2.png"> -->            
            <a href="latestCases.html">         
                <img src="icons/Documents-icon_2.png" class="ui-li-thumb">
                <h1 class="ui-li-heading">Lates cases</h1>           
                <p class="ui-li-desc">view latest cases</p>
            </a>
            <span id="num" class="ui-li-count ui-btn-up-c ui-btn-corner-all">12</span>
        </li>
        <li>
            <!--<a href="caseSearch.html">-->
            <a id="caseClick" href="caseSearch.html" data-rel="panel">
            <img src="icons/searchIcon.png" class="ui-li-thumb">
            <h1>Case search</h1>           
            <p>search for cases</p>
            </a>
        </li>
        <li>
            <a id="legislationClick" href="#mypanel" data-rel="panel">
            <img src="icons/legislation.png" class="ui-li-thumb">
            <h1>Legislation search</h1>           
            <p>search for legislations</p>
            </a>
        </li>
        <li>
            <a id="referencesClick" href="#mypanel">
            <img src="icons/searchIcon2.png" class="ui-li-thumb">    
            <h1>References</h1>           
            <p>read the references</p>
            </a>
        </li>
        <li>
            <a href="#">
            <img src="icons/helpIcon.png" class="ui-li-thumb">    
            <h1>Help</h1>           
            <p>look for help</p>
            </a>
        </li>
    </ul>
</article>
         
     </div><!-- /content -->

        <div data-role="footer" data-position="fixed" data-id="footer1">        
            <div data-role="navbar">
                <ul>
                    <li><a href="latestCases.html" data-icon="star">Latest</a></li>
                    <li><a id="caseClick1" href="#mypanel" data-icon="search">Cases</a></li>
                    <li><a id="legislationClick1" href="#mypanel" data-icon="search">Legislation</a></li>
                    <li><a id="referencesClick1" href="#mypanel" data-icon="info">References</a></li>
                    <li><a href="help.html" data-icon="alert">Help</a></li>
                </ul>
            </div><!-- /navbar -->
        </div><!-- /footer -->   
		<script>
		$("#register").on("click",function(){
			url = "http://elaw.com.my/test2/subscription_single_corporate.aspx"
			navigator.app.loadUrl(url, { openExternal:true });			
		});
		</script>
        </div><!-- /page -->

</body>
<script>
    $('#main').on('pageinit',function(event){
        $("#main #login").on("click",function(){
            //console.log('login click ?');
            $("#error").html("");
            var username = $("#un").val();
            var password = $("#pw").val();
            if(username && password){
                $.userName = username;
                url = 'http://elaw.com.my/test2/mobile/loginmobile.aspx?u='+username;
                url += '&pass='+password;
                url += '&callback=?';
                getJson(url,"main");
            }
        });

            $("#main a").on("click",function(){
                //console.log($(this).attr('id')+" "+$(this).attr('href'));
                var obj = $(this);
                //console.log(obj.attr('id'));
                if(obj.attr('id') == 'caseClick' || obj.attr('id')=='caseClick1'){
                    $.redirectTo = 'caseSearch.html';
                }
                if(obj.attr('id') == 'legislationClick1' || obj.attr('id')=='legislationClick'){
                    $.redirectTo = 'legislationSearch.html';
                }
                if(obj.attr('id') == 'referencesClick' || obj.attr('id')=='referencesClick1'){
                    $.redirectTo = 'references.html';
                }
            });        
    });
    $.handleData = function(data,pageId){
        //console.log(data);
        if(pageId == "main"){
            if(data.reply == "loggedin"){
            console.log('loggedin');
            console.log($.redirectTo);
            $.mobile.changePage($.redirectTo);
            }   
            else{
                //console.log('what');
                $("#error").html(data.reply);
            }
        }
        if(pageId == "caseSearchResults"){
            var html = '';
            console.log(data);
            var u = $.userName;
            $.each(data.results,function(index,elem){
                //var arguments = '?name='+elem.fileName+'&ec='+ec+'&u='+u;
                html += '<li><a href="case.html"><h1>'+elem.title+'</h1><p>'+elem.Court+'</p></a></li>';
                    //console.log(elem);
            });
            if(html === ''){
                html = '<li>No results</li>'
                //console.log(html);
                }
            $('#caseSearchResults #mylist2').html(html);
            $('#caseSearchResults #mylist2').listview('refresh'); 
            //return html;
        }


        
    }
    $.getJson = function(url,pageId){
        /*console.log("getjson "+url+" "+pageId);
        data = {};
        data.reply = 'loggedin'*/
        $.getJSON(url,function(data){
            $.handleData(data,pageId);
        });
        //$.handleData(data,pageId);
    }
    function makeUrl(pageId){
        if(pageId == "#main"){

        }
    }
    function getData(data){

    }
    function swipe_it(){
        //$.moible.changePage("latestCases.html");
        //alert('ys');
    }
     
    /*$(document).delegate('#main', 'pageshow', runIt);
    $('#main').on('pageshow', runIt);
    $("#main").swipeleft(function(){
        $.mobile.changePage("latestCases.html","slide");
    });*/
</script>
</html>